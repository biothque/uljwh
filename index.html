<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription 2025 ‚Äì Thoth</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/backendless"></script>
</head>
<body>
    <div class="overlay"></div>

    <header>
        <h1>INSCRIPTION 2025</h1>
        <p>Rejoignez-nous pour explorer la ligne temporelle</p>
    </header>

    <main>
        <form id="signupForm" class="signup-form">
            <div class="form-group">
                <label for="email">Email :</label>
                <input type="email" name="email" id="email" placeholder="exemple@domaine.com" required>
            </div>

            <div class="form-group">
                <label for="nom">Noms :</label>
                <input type="text" name="nom" id="nom" placeholder="Ex : NOM POSTNOM PRENOM" required>
            </div>

            <div class="form-group">
                <label for="institut">Lieu de naissance :</label>
                <input type="text" name="institut" id="institut" placeholder="Ex : Kwilu-ngongo" required>
            </div>

            <div class="form-group">
                <label for="option">Date de naissance :</label>
                <input type="date" name="option" id="option" placeholder="Ex : 30/09/2000" required>
            </div>

            <div class="form-group">
                <label for="genre">Genre :</label>
                <select name="genre" id="genre" required>
                    <option value="">-- S√©lectionnez --</option>
                    <option value="Homme">Homme</option>
                    <option value="Femme">Femme</option>
                </select>
            </div>

            <div class="form-group">
                <label for="pere">Nom du p√®re :</label>
                <input type="text" name="pere" id="pere" placeholder="Ex : DIANGANI" required>
            </div>

            <div class="form-group">
                <label for="mere">Nom de la m√®re :</label>
                <input type="text" name="mere" id="mere" placeholder="Ex : NDUNDU" required>
            </div>

            <div class="form-group">
                <label for="annee">Ann√©e d'obtention de dipl√¥me :</label>
                <input type="text" name="annee" id="annee" placeholder="Ex : 2019" required>
            </div>

            <div class="form-group">
                <label for="ecole">Ecole/option faite :</label>
                <input type="text" name="ecole" id="ecole" placeholder="Ex : Boboto/Latin philo" required>
            </div>

            <div class="form-group">
                <label for="abonnement">Facult√© :</label>
                <select name="abonnement" id="abonnement" required>
                    <option value="">-- S√©lectionnez --</option>
                    <option value="Agronomie">Individuel</option>
                    <option value="Droit">Collectif</option>
                    <option value="Theologie">Institutionnel</option>
                    <option value="Informatiquedegestion">Individuel</option>
                    <option value="Environnement">Collectif</option>
                    <option value="Telecom">Institutionnel</option>
                    <option value="Scinfirmiere">Individuel</option>
                    <option value="Sceconomique">Collectif</option>
                    <option value="Santepub">Institutionnel</option>
                    <option value="Sccommunication">Collectif</option>
                    <option value="Scsocialepolitique">Institutionnel</option>
                    <option value="Sceconomiqueetrepr">Individuel</option>
                    <option value="Centreanglais">Collectif</option>
                    <option value="Centreinformatique">Institutionnel</option>
                </select>
            </div>

            <div class="form-group">
                <label for="montant">Partenaire :</label>
                <select name="montant" id="montant" required>
                    <option value="">-- S√©lectionnez --</option>
                    <option value="Campbaramoto">Camp militaire de Baramoto</option>
                    <option value="Camptshatshi">Camp militaire de Tshatshi</option>
                    <option value="Autres">Autres</option>
                </select>
            </div>

            <button type="submit" class="btn-submit">S'inscrire</button>

            <p id="successMessage" class="message success">Un email de confirmation a √©t√© envoy√© √† votre adresse.</p>
            <p id="errorMessage" class="message error"></p>
        </form>
    </main>

    <footer>
        <p>üìû Contact : +243 900 000 000 | ‚úâÔ∏è Email : contact@centre2025.cd</p>
        <p>üì≤ WhatsApp : <a href="https://wa.me/243900000000" target="_blank">Rejoignez notre cha√Æne</a></p>
    </footer>

    <script>
        // Backendless config
        const APP_ID = "75F9B527-FE0B-4C7E-B2F4-1AD71EE054A0";
        const API_KEY = "60E69D44-7601-447C-B228-6E26EE396C20";
        const TABLE  = "membres";

        Backendless.initApp(APP_ID, API_KEY);

        const form = document.getElementById('signupForm');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = form.email.value.trim();
            const nom = form.nom.value.trim();
            const institut = form.institut.value.trim();
            const option = form.option.value.trim();
            const genre = form.genre.value.trim();
            const pere = form.pere.value.trim();
            const mere = form.mere.value.trim();
            const annee = form.annee.value.trim();
            const ecole = form.ecole.value.trim();
            const abonnement = form.abonnement.value.trim();
            const montant = form.montant.value.trim();

            try {
                const query = Backendless.Data.QueryBuilder.create().setWhereClause(`email = '${email}'`);
                const existing = await Backendless.Data.of(TABLE).find(query);

                if (existing.length > 0) {
                    errorMessage.style.display = "block";
                    errorMessage.textContent = "Ce compte existe d√©j√† !";
                    return;
                }

                const membre = { email, nom, institut, option, genre, abonnement, montant };
                await Backendless.Data.of(TABLE).save(membre);

                successMessage.style.display = "block";
                errorMessage.style.display = "none";
                form.reset();

                setTimeout(() => {
                    window.location.replace("login.html");
                }, 8000);

            } catch (error) {
                console.error(error);
                errorMessage.style.display = "block";
                errorMessage.textContent = "Une erreur est survenue, r√©essayez.";
            }
        });

        // Emp√™cher retour arri√®re
        history.pushState(null, null, location.href);
        window.onpopstate = function () { history.go(1); };
    </script>
</body>
</html>
